# AGENTS.md — SteadyDad (First-Time Dad Baby App) — Build Instructions for Coding Agent

You are an expert mobile engineer building a production-quality Expo + React Native app in TypeScript.

## 0) Objective

Build **SteadyDad**, a **local-first** baby companion app designed for **first-time dads**, focused on:
- One-tap **activity tracking** (feed, diaper, sleep, mood)
- A **timeline** of events
- A **dashboard** with “last fed / last diaper / sleep status”
- A “**What should I do?**” guided helper (non-AI rules/checklists)
- A **Dad Guidance** daily feed
- **Milestones** (log date/photo/note)
- Offline-first. No required accounts.

MVP should feel **native**, simple, and fast for one-hand use.

---

## 1) Tech Stack & Constraints

### Required
- **Expo** (latest stable)
- **TypeScript**
- **Expo Router**
- Local-first storage using **op-sqlite** (preferred)
- Clean architecture with a small data layer (repositories/services)
- Must work fully offline

### Optional later (not in MVP)
- Cloud sync
- On-device AI assistant
- Watch / Siri

### UI/UX constraints
- Minimal whitespace-heavy UI
- Large tap targets
- Avoid complex forms
- 1–2 taps to log common events

---

## 2) App Navigation (Expo Router)

Use a bottom tab layout with these routes:

- `/(tabs)/dashboard`
- `/(tabs)/timeline`
- `/(tabs)/guidance`
- `/(tabs)/milestones`
- `/(tabs)/settings`

Onboarding:
- `/onboarding/welcome`
- `/onboarding/baby-info`
- `/onboarding/dad-goals`
- `/onboarding/finish`

Helper flow:
- `/helper` (entry)
- `/helper/[topic]` (checklist screen)

---

## 3) Data Model

### Entities

**BabyProfile**
- `id: string`
- `name: string`
- `birthDate: string` (ISO)
- `createdAt: number`

**Event**
- `id: string`
- `babyId: string`
- `type: 'feed' | 'diaper' | 'sleep_start' | 'sleep_end' | 'mood'`
- `timestamp: number` (ms)
- `metadataJson: string` (JSON stringify for flexible metadata)

**Milestone**
- `id: string`
- `babyId: string`
- `title: string`
- `timestamp: number`
- `note?: string`
- `photoUri?: string`

**GuidanceItem**
- `id: string`
- `dayIndex: number` (e.g., days since birth)
- `title: string`
- `body: string`

**GuidanceViewed**
- `id: string`
- `babyId: string`
- `guidanceId: string`
- `viewedAt: number`

### Event metadata details
- feed: `{ type: 'breast_milk'|'formula'|'solid', amountMl?: number, note?: string }`
- diaper: `{ kind: 'wet'|'dirty'|'both', note?: string }`
- sleep_start: `{ note?: string }`
- sleep_end: `{ note?: string }`
- mood: `{ mood: 'happy'|'fussy'|'crying'|'calm', note?: string }`

---

## 4) Storage Layer (op-sqlite)

### Schema (SQLite)

Create `src/db/schema.ts` containing SQL migrations:

- `baby_profiles`
- `events`
- `milestones`
- `guidance_items`
- `guidance_viewed`

Key indexes:
- `events(babyId, timestamp DESC)`
- `milestones(babyId, timestamp DESC)`
- `guidance_viewed(babyId, guidanceId) UNIQUE`

### Repository interfaces
Create:
- `src/data/BabyRepo.ts`
- `src/data/EventRepo.ts`
- `src/data/MilestoneRepo.ts`
- `src/data/GuidanceRepo.ts`

Use a single `Database` module:
- `src/db/db.ts` (open connection, apply migrations once, helpers)

---

## 5) Core Features & Acceptance Criteria

### A) Onboarding
**Goal:** Create BabyProfile and land on Dashboard.
- Must allow entering baby name + birth date
- Must persist profile locally
- Must skip onboarding on next launches if profile exists

Acceptance:
- Fresh install → onboarding shown
- After completion → tabs visible
- Relaunch → dashboard loads with saved baby profile

---

### B) Activity Tracking (1-tap logging)
Dashboard provides quick actions:
- Feed
- Diaper
- Sleep (toggle start/end based on current status)
- Mood

Acceptance:
- Tap Feed → minimal modal/action sheet to pick type + optional amount → save event
- Tap Diaper → pick wet/dirty/both → save event
- Tap Sleep:
  - if last sleep event is `sleep_start` without `sleep_end`, then create `sleep_end`
  - else create `sleep_start`
- Tap Mood → pick mood tag → save event
- All events appear in Timeline immediately

Performance:
- Save and update UI should feel instant (<200ms perceived)

---

### C) Dashboard
Show:
- Baby name + age (days/weeks)
- Last fed time (relative)
- Last diaper time (relative)
- Sleep status:
  - If sleeping: “Sleeping for X”
  - If awake: “Last sleep ended X ago”
- Quick action buttons

Acceptance:
- Data reflects the most recent events
- Handles “no events yet” gracefully

---

### D) Timeline
List events in reverse chronological order.
Each item shows:
- time
- type icon/label
- a short summary (e.g., “Diaper: Wet”, “Feed: Formula”, “Mood: Fussy”)

Acceptance:
- Infinite scroll / pagination optional; MVP can load last 200 events
- Pull to refresh optional; local data so refresh is just re-query

---

### E) “What should I do?” Helper (rule-based)
Entry screen shows topic buttons:
- Baby is crying
- Baby won’t sleep
- Baby is fussy
- Baby hasn’t eaten in a while
- Baby seems uncomfortable

Each topic leads to a checklist with steps and a “Done” acknowledgement.

Include a lightweight “context banner” at top using last events:
- “Last fed: X ago”
- “Last diaper: X ago”
- “Sleep: awake/sleeping”

Acceptance:
- Works offline
- No AI. No external calls.
- Topic screens are fast and readable

---

### F) Dad Guidance Feed
Show one daily tip based on baby’s age in days.
- Compute `dayIndex = floor((now - birthDate)/day)`
- Show guidance item for that dayIndex (fallback to nearest <= dayIndex)

MVP guidance content:
- Seed ~60 items (first 2 months) as JSON file in app bundle
- On first run, load into SQLite if empty

Acceptance:
- User can scroll previous tips
- Mark tip as “viewed” when opened

---

### G) Milestones
List milestones and allow adding:
- Title (required)
- Date/time (default now)
- Optional note
- Optional photo (use Expo ImagePicker)

Acceptance:
- Add milestone persists and shows in list
- Photo displayed in detail view

---

### H) Settings
- Edit baby name / birth date
- Export data (JSON file) to share sheet
- Reset all data (confirm modal)

Acceptance:
- Export generates a JSON bundle containing profile, events, milestones
- Reset wipes local DB tables

---

## 6) Non-Functional Requirements

- Offline-first, no auth required
- No analytics required for MVP
- Data should be stored locally and remain on device unless exported
- Graceful empty states everywhere
- Avoid heavy dependencies; keep bundle lean

---

## 7) File/Folder Structure

Create this structure:
app/
(tabs)/
dashboard.tsx
timeline.tsx
guidance.tsx
milestones.tsx
settings.tsx
onboarding/
welcome.tsx
baby-info.tsx
dad-goals.tsx
finish.tsx
helper/
index.tsx
[topic].tsx
src/
db/
db.ts
schema.ts
data/
BabyRepo.ts
EventRepo.ts
MilestoneRepo.ts
GuidanceRepo.ts
domain/
types.ts
helpers/
time.ts
babyAge.ts
eventSummary.ts
ui/
components/
PrimaryButton.tsx
Card.tsx
EmptyState.tsx
EventRow.tsx
QuickActionRow.tsx
theme/
spacing.ts
typography.ts
colors.ts
assets/
guidance/
guidance.seed.json

---

## 8) Implementation Plan (Step-by-step)

### Step 1 — Bootstrap project
- Init Expo app with TS
- Install Expo Router and configure tabs
- Add minimal theme primitives

### Step 2 — SQLite + migrations
- Add op-sqlite
- Implement db open + migration runner
- Implement repos with basic CRUD

### Step 3 — Onboarding
- Build onboarding screens
- Persist BabyProfile
- Route gating: if no profile, redirect to onboarding

### Step 4 — Dashboard + Quick Actions
- Implement queries for “last events”
- Add quick action modals
- Implement sleep toggle logic

### Step 5 — Timeline
- Query recent events
- Render list with summaries

### Step 6 — Helper
- Build helper topic list + topic detail checklist
- Context banner using last events

### Step 7 — Guidance
- Seed guidance JSON into DB on first run
- Build feed and “viewed” table

### Step 8 — Milestones
- CRUD milestones + image picker
- List + detail view

### Step 9 — Export + Reset
- Export JSON to file + share sheet
- Reset with confirmation

### Step 10 — Polish
- Empty states, error boundaries, loading states
- Large hit targets + haptics (optional)
- Basic unit tests for helpers (optional)

---

## 9) Key Algorithms / Logic

### Sleep Status
- Find latest sleep event (start/end)
- If latest is `sleep_start` and there is no subsequent `sleep_end`, baby is sleeping
- Duration computed from `sleep_start.timestamp` to now

### “Last X” Labels
- Compute relative times (“5m ago”, “2h ago”, “yesterday”)
- Provide absolute time in smaller text optionally

### Guidance dayIndex
- `dayIndex = floor((now - birthDate) / 86400000)`
- Clamp to [0..maxSeedDay]

---

## 10) Testing Checklist (Manual)

- Onboarding completes and persists
- Logging feed/diaper/mood adds events immediately
- Sleep toggle works correctly across multiple taps
- Timeline ordering correct
- Helper topics open and checklists usable one-handed
- Guidance shows correct day based on birth date changes
- Milestones can be added with/without photo
- Export produces valid JSON and contains all entities
- Reset wipes everything and returns to onboarding

---

## 11) “Done” Definition for MVP

MVP is done when:
- All tabs functional
- Onboarding gates the app
- Events can be logged and displayed correctly
- Guidance + helper provide usable dad support
- Export/reset work
- App feels fast and clean on both iOS and Android

---

## 12) Build Notes / Preferences

- Prefer simple, readable code over abstractions
- Keep components small
- Use a single source of truth for current baby profile
- Keep UI whitespace-heavy; avoid dense tables
- No network calls in MVP

---

## 13) Seed Content (Guidance)

Create `assets/guidance/guidance.seed.json` with objects:
`{ id, dayIndex, title, body }`

Include at least 60 tips (days 0–59). Keep tone:
- Practical
- Encouraging
- Dad-forward
- Actionable

---

If you implement this, the app should be immediately useful for a first-time dad in the first week home.
